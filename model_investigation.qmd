---
title: "Supplementary Information - Paper Title"
format: html
---

Authors: Isabella C. Richmond^1^\*, Thi Thanh Hiên Pham^2^, Emile Tchinda^2^, Carly D. Ziter^1^

1 Department of Biology, Concordia University, Montreal Canada, H4B 1R6

2 Département d'études urbaines et touristiques, Université du Québec à Montréal, Montreal Canada,

\* isabella.richmond\@mail.concordia.ca



```{r, include = FALSE}
source('R/packages.R')

tar_load(language_de_brms_sample_prior)


plot_prior <- function(mod, xmin, xmax, ylab){
  
  # how to sequence data
  seq_d <- seq(xmin, xmax, by = 0.5)
  
  # pull variables from model 
  vars <- colnames(mod$data)[-1]
  
  # identify categorical variables 
  factors <- names(Filter(is.factor,mod$data[-1]))
  
  # identify numeric variables 
  numeric <- names(Filter(is.numeric,mod$data[-1]))
  
  figlist <- lapply(numeric, function(x){
    
    df <- data.frame(matrix(ncol=length(vars),nrow=0, dimnames=list(NULL, vars)))
    
    df %<>%
      summarise_at(x, ~seq_d) %>%
      bind_rows(df, .) %>%
      mutate(across(all_of(factors), as.factor)) %>% 
      mutate(across(all_of(numeric), ~ replace(., is.na(.), 0)))
    
    epred <- add_epred_draws(df, mod)
    
    ggplot(epred, aes(x = get(x), y = .epred)) +
      geom_line(aes(group = .draw), alpha = 0.1) +
      labs(y = ylab, x = x) +
      theme_classic()
    
  })
}
```

# Causality 

First, let's investigate the DAG. Based on our assumptions, to test the direct effect of language on tree values and beliefs, we need to include ethnicity and city type in our model.

![](graphics/dag.png)

# Prior predictive simulation

Prior predictive checks are used to ensure that the values selected for priors for our models allow a  reasonable range of values. For numeric predictor variables, we simulate predictive draws for prior only models and visualize the slope/intercept of the values. We then do a "posterior predictive check" but with the prior only model, to see if the data is captured in the priors. Note that all data is scaled and centered in these data.


```{r}



```


## Model diagnostics



## Old 
Now, let's look at the model with the data: 

```{r}
d_model <- tar_read(init_model_cmdstanr)


# model formula
d_model$formula

# priors
prior_summary(d_model)

# check diagnostics
plot(d_model)

d_model %>% 
  spread_draws(r_question_category[question_category, term]) %>% 
  ggplot(aes(x = r_question_category, y = question_category)) +
  stat_halfeye()

# look at variation in question
draws_questions <- d_model %>% 
  spread_draws(r_question[question, term]) %>% 
  mutate(question_cat = case_when(str_detect(question, 'uf_vals') ~ 'value',
                                  str_detect(question, 'beliefs_positive') ~ 'beliefs_positive',
                                  str_detect(question, 'beliefs_negative') ~ 'beliefs_negative',
                                  str_detect(question, 'beliefs_extra_positive') ~ 'beliefs_positive', 
                                  str_detect(question, 'beliefs_extra_negative') ~ 'beliefs_negative'))

draws_questions %>% 
  filter(question_cat == 'value') %>%
  ggplot(aes(x = r_question, y = question)) +
  stat_halfeye()

draws_questions %>% 
  filter(question_cat == 'beliefs_positive') %>% 
  ggplot(aes(x = r_question, y = question)) +
  stat_halfeye()

draws_questions %>% 
  filter(question_cat == 'beliefs_negative') %>% 
  ggplot(aes(x = r_question, y = question)) +
  stat_halfeye()
```


